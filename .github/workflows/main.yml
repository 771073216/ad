name: release
on:
  schedule:
    - cron: "0 0 * * *"
  watch:
      types: started
  push:
    branches:
      - master
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout out project files
        uses: actions/checkout@v2
        with:
          fetch-depth: 1

      - name: Check and release
        run: |
          sudo rm /etc/localtime
          sudo ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
          time=$(date +%Y%m%d%H%M%S)
          day=$(date +%Y%m%d)
          wget https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-easylist.txt -O 1.txt
          wget https://raw.githubusercontent.com/banbendalao/ADgk/master/ADgk.txt -O 2.txt
          sed -i '/^!/d' 1.txt 2.txt
          cat 1.txt 2.txt | sort -u > ad.txt
          sed -i "1i !version: ${time}" ad.txt
          git add ad.txt
          git config user.name "771073216"
          git config user.email "771073216@qq.com"
          git commit -m "$day" -a
          git push
