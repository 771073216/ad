name: release
on:
  schedule:
    - cron: "0 0 1 * *"
  watch:
      types: started
jobs:
  build:
    name: Sync
    runs-on: ubuntu-latest
    steps:
      - name: Checkout out project files
        uses: actions/checkout@v3

      - name: Check and release
        run: |
          sudo rm /etc/localtime
          sudo ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
          time=$(date +%Y%m%d%H%M%S)
          curl -sSL https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-easylist.txt > origin.txt
          curl -sSL https://raw.githubusercontent.com/banbendalao/ADgk/master/ADgk.txt >> origin.txt
          cat custom.txt >> origin.txt
          sort -u origin.txt -o sorted.txt
          sed -i '/^!/d' sorted.txt
          sed -i '/^ÔºÅ/d' sorted.txt
          mv sorted.txt ad.txt
          sed -i "1i !Version: ${time}" ad.txt
          sed -i "2i !Title: custom adblock list" ad.txt
          git add ad.txt
          git config --local user.name "github-actions[bot]"
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git commit -m "Version: $time" -a
          git push
